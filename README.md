유튜브 영상 : https://youtu.be/xyVCujzZKqc



회로도 : https://www.tinkercad.com/things/4AYjenSZ41s/editel

![image](https://github.com/user-attachments/assets/7b48dc20-70f4-4a07-9518-4da79ef6f99e)




# Arduino와 p5.js를 활용한 LED 제어

이 프로젝트는 Arduino와 p5.js를 사용하여 신호등LED 제어 및 시리얼 통신을 처리하여 LED의 지속시간을 설정하는 시스템입니다. 이를 통해 신호등을 시뮬레이션하며, 버튼을 눌렀을 때 특정 동작을 실행하고, p5.js를 통해 LED의 지속 시간을 조절하거나 모드를 확인하는등 다양한 동작을 확인할 수 있습니다.

## 신호등의 기본 동작

이 시스템은 **신호등**처럼 동작하는 3개의 LED를 제어합니다. 각 LED는 빨간색, 노란색, 초록색을 나타내며, 각각은 버튼을 눌렀을 때 특정 상태로 변경됩니다.

### 1. **기본 동작**
- **초록 LED**는 2초 동작후 꺼집니다.
- **노란 LED**는 0.5초 동작후 꺼집니다. 후에 초록불이 3번 깜빡인 후에 다시 동작합니다.
- **빨강 LED**는 2초 동작 후에 노란불이 켜지도록 합니다.

### 2. **버튼을 눌렀을 때의 변화**
### 버튼 기능 설명

| 버튼 번호 | 기능              | 설명                                          |
|-----------|-------------------|---------------------------------------------|
| **버튼 1** | 비상 버튼 (Emergency) | 눌렀을 때 모든 LED가 꺼지고 빨강LED만 점등합니다. |
| **버튼 2** | 전체 깜빡임 (Blinking) | 눌렀을 때 모든 LED가 0.5초 간격으로 깜빡입니다. |
| **버튼 3** | 온/오프 기능 (On/Off) | 눌렀을 때 모든 LED가 켜지거나 꺼집니다. |


## p5.js로 조작 가능한 부분

### 1. **LED 지속 시간 조정**
p5.js에서는 각 LED에 대한 지속 시간을 **슬라이더**로 조정할 수 있습니다. 슬라이더를 사용하여 각 LED의 지속 시간을 실시간으로 조정할 수 있으며, 이를 Arduino에 전달하면 Arduino가 해당 LED의 지속 시간을 반영하여 색상 지속시간 상태를 변경합니다.

### 2. **실시간 LED 상태 표시**
p5.js는 Arduino에서 받은 데이터를 기반으로 현재 활성화된 LED의 상태를 화면에 표시합니다. 화면에 나타나는 LED는 빨간, 노란, 초록 LED의 색상을 각각 나타내며, p5.js에서 실시간으로 변경됩니다.


## p5.js에서 아두이노 조작 방법

### 1. **시리얼 통신을 통한 제어**
p5.js는 **시리얼 통신**을 통해 Arduino와 데이터를 주고받습니다. 이를 통해 p5.js는 Arduino에서 보내는 데이터를 받아서 화면에 표시하며, 슬라이더에서 입력한 값을 Arduino로 전송하여 LED의 지속 시간을 조정합니다.

### 2. **p5.js의 `serial` 객체 사용**
- p5.js에서는 `serial` 객체를 사용하여 Arduino와 연결합니다.
- `serial.list()`로 연결 가능한 시리얼 포트를 확인하고, `serial.open()`을 통해 연결합니다.
- 시리얼 포트가 열리면, p5.js는 `serial.write()`를 사용하여 데이터를 Arduino로 전송하고, `serial.on('data', callback)`을 사용하여 Arduino로부터 받은 데이터를 처리합니다.

### 3. **슬라이더 값 전송**
p5.js에서 제공하는 슬라이더를 사용하여 각 LED의 지속 시간을 조절할 수 있습니다. 슬라이더의 값은 실시간으로 Arduino로 전송되며, Arduino는 해당 값을 받아 LED의 지속 시간을 반영합니다. 예를 들어, 슬라이더를 움직여 빨간 LED의 지속 시간을 설정하면 Arduino가 그 값에 맞게 빨간 LED를 제어합니다.


### 4. **코드**

코드부분은 task를 LED 별로 나누어 task를 할당하였고 이를 통하여 web p5 에서도 조절 가능하도록 하였습니다. 
serial통신을 사용하여 0.1초 간격으로 통신 하도록 만들었으며 현재 상태를 그대로 p5 화면에 반영할 수 있도록 하였습니다.

## 개요

이 프로젝트는 아두이노에서 신호등을 구현하는 프로그램입니다. `TaskScheduler` 라이브러리를 사용하여 LED의 모드를 제어하고, 버튼 입력 및 아날로그 입력을 처리합니다. 사용자는 버튼을 눌러 신호등 모드를 전환하거나, `Serial` 통신을 통해 신호등의 상태를 제어할 수 있습니다. 또한, `POTENTIOMETER`를 통해 LED 밝기를 조정할 수 있습니다.

## 하드웨어 구성

- **LED**:
  - 빨간 LED (RED_LED)
  - 노란 LED (YELLOW_LED)
  - 초록 LED (GREEN_LED)

- **버튼**:
  - BUTTON_B1: 비상모드를 활성화하는 버튼
  - BUTTON_B2: 전체 깜빡임 모드를 활성화하는 버튼
  - BUTTON_B3: 전체를 on/off하는 버튼
  
- **POTENTIOMETER**: 아날로그 입력을 통해 LED 밝기를 조정하는 포텐셔미터

## 기능

### 1. 모드 전환

프로그램은 3개의 모드를 제공합니다. 각 모드는 버튼을 통해 전환할 수 있습니다.

- **모드 0 (기본 모드)**: 
  - 빨간, 노란, 초록 LED가 순차적으로 켜지고 꺼집니다. 각 LED의 켜짐 시간을 설정할 수 있습니다.
  
- **모드 1 (비상 모드)**:
  - 빨간 LED만 켜지며, 다른 LED는 꺼집니다. 이 모드는 버튼 B1을 눌러 활성화할 수 있습니다.
  
- **모드 2 (깜빡임 모드)**:
  - 빨간, 노란, 초록 LED가 모두 0.5초 간격으로 깜빡입니다. 이 모드는 버튼 B2를 눌러 활성화할 수 있습니다.
  
- **모드 3**: 
  - 전체 on/off모드. 버튼 B3을 눌러 활성화하거나 비활성화할 수 있습니다.

### 2. 버튼 디바운스 처리

버튼을 누를 때 발생할 수 있는 잡음을 처리하기 위해, 각 버튼에 대해 디바운스 처리를 적용합니다. 이는 버튼이 눌릴 때 발생하는 여러 신호를 방지하여 정확한 버튼 동작을 보장합니다.

### 3. LED 밝기 조절

- **POTENTIOMETER**: 아날로그 입력을 통해 LED의 밝기를 조절할 수 있습니다. 포텐셔미터의 값은 0부터 1023까지의 범위로 읽히며, 이 값을 0에서 255까지의 밝기 값으로 변환하여 LED에 적용합니다.

### 4. `Serial` 통신

`Serial` 통신을 통해 외부에서 신호등의 모드나 LED 상태를 제어할 수 있습니다. JSON 형식으로 데이터를 받아와 모드를 전환하거나, LED의 동작 시간을 변경할 수 있습니다.

## 사용법

1. **버튼을 눌러 모드 전환**:
   - BUTTON_B1: 모드 1 (레드 LED만 켜기)
   - BUTTON_B2: 모드 2 (LED 깜빡임)
   - BUTTON_B3: 모드 3 (전체 on/off)

2. **POTENTIOMETER**를 조정하여 LED의 밝기를 실시간으로 변경할 수 있습니다.

3. **`Serial` 통신**을 통해 JSON 형식으로 데이터를 받아서, 신호등 모드와 각 LED의 켜짐 시간을 변경할 수 있습니다. 예를 들어, 모드를 변경하려면 `mode1`, `mode2`, `mode3`와 같은 데이터를 전송할 수 있습니다.

## 동작 원리

1. `setup()` 함수에서 초기화 작업을 합니다. 이때, 각 LED 핀을 출력 모드로 설정하고, 버튼 핀을 입력으로 설정합니다.
2. `loop()` 함수는 계속 실행되며, `TaskScheduler`의 `execute()` 함수가 주기적으로 호출되어 등록된 작업들을 처리합니다.
3. 각 모드별로 LED의 동작을 제어하는 작업들이 `Task` 객체로 등록됩니다. 각 `Task`는 지정된 시간 간격으로 반복적으로 실행됩니다.
4. 버튼을 눌렀을 때 디바운스 처리가 되어 모드가 변경되고, 해당 모드에 맞는 LED 동작이 실행됩니다.
5. `POTENTIOMETER`를 통해 LED의 밝기가 조절되며, `Serial` 통신을 통해 실시간으로 데이터를 수신하여 LED 상태를 업데이트합니다.



